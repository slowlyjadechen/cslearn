# 第三章 基本的bash shell命令

## 本章内容

- 使用shell
- bash手册 `man` `info` `-help` `--help`
- 浏览文件系统 `pwd` `cd`
- 文件和目录列表 `ls`
- 管理文件和目录 `touch` `cp` `ln` `mv` `rm` `mkdir` `rmdir`
- 查看文件内容 `file` `cat` `more` `less` `tail` `head`

## 使用shell

/etc/passwd文件包含了所有系统用户账户列表以及每个用户的基本配置信息。以下是从/etc/passwd文件中取出的样例条目：

```shell
christine:x:501:501:Christine Bresnahan:/home/christine:/bin/bash
```

- 每个条目有七个字段，字段之间用冒号分隔。
- 最后一个字段指定了用户使用的shell程序.在前面的/etc/passwd样例条目中，用户christine使用/bin/bash作为自己的默认shell程序。这意味着当christine登录Linux系统后，bash shell会自动启动。

shell 提示符

```shell
[christine@server01 ~]$
```


除了作为shell的入口，提示符还能够提供其他的辅助信息。在上面的两个例子中，提示符中显示了当前用户ID名christine。另外还包括系统名server01。

## bash 手册

### man命令

- man命令用来访问存储在Linux系统上的手册页面。在想要查找的工具的名称前面输入man命令，就可以找到那个工具相应的手册条。

- man工具通常提供的是命令所对应的最低编号的内容。例如，输入的是命令man xterm，在现实内容的左上角和右上角，单词XTERM后的括号中有一个数字：(1)。这表示所显示的手册页来自内容区域1（可执行程序或shell命令）。

- 一个命令偶尔会在多个内容区域都有对应的手册页。比如说，有个叫作hostname的命令。手册页中既包括该命令的相关信息，也包括对系统主机名的概述。要想查看所需要的页面，可以输入`man section# topic`。<u>**对手册页中的第1部分而言，就是输入man 1 hostname。对于手册页中的第7部分，就是输入man 7 hostname。**</u>

  浏览文件系统

### info \<topic\>

### -help或--help选项

例如你可以输入hostname -help来查看帮助

## Linux 文件系统

- Linux将文件存储在单个目录结构中，这个目录被称为`虚拟目录`（virtual directory）。虚拟目录将安装在PC上的所有存储设备的文件路径纳入单个目录结构中。
- Linux虚拟目录结构只包含一个称为根（root）目录的基础目录。

- 在Linux PC上安装的第一块硬盘称为`根驱动器`。根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的。Linux会在根驱动器上创建一些特别的目录，我们称之为`挂载点`（mount point）。**<u>挂载点是虚</u>**
  **<u>拟目录中用于分配额外存储设备的目录。**</u>虚拟目录会让文件和目录出现在这些挂载点目录中，然
  而实际上它们却存储在另外一个驱动器中。通常系统文件会存储在根驱动器中，而用户文件则存储在另一驱动器中
- 文件系统层级标准（filesystem hierarchy standard，FHS）

### 遍历目录

- cd命令:	

  - `cd destination`

  - 如果没有为cd命令指定目标路径，它将切换到用户主目录

> 提示符中波浪号（~）表明shell会话位于你的主目录中

- `pwd`命令可以显示出shell会话的当前目录，这个目录被称为当前工作目录

- 有两个特殊字符可用于相对文件路径中：
  - 单点符（.），表示当前目录；
  - 双点符（..），表示当前目录的父目录。

## 文件和目录列表

### ls命令

#### 参数

- `-F参数`的ls命令轻松区分文件和目录,-F参数在目录名后加了正斜线（/），它会在可执行文件的后面加个星号，以便用户找出可在系统上运行的文件。

- `-a参数`把隐藏文件和普通文件及目录一起显示出来。Linux经常采用隐藏文件来保存配置信息。在Linux上，隐藏文件通常是文件名以点号开始的文件。这些文件并没有在默认的ls命令输出中显示出来，因此我们称其为隐藏文件。

- `-R参数`叫作递归选项。它列出了当前目录下包含的子目录中的文件。

- `-l参数`会产生长列表格式的输出，包含了目录中每个文件的更多相关信息。

- ls –l命令，并不会显示访问时间。默认显示的是修改时间。要想查看文件的访问时间，需要加入另外一个参数：`--time=atime`

#### 输出

- 第一行显示了在目录中包含的总块数
- 下面的行显示文件的具体信息：
  - **<u>文件类型，比如目录（d）、文件（-）、字符型文件（c）或块设备（b）</u>**
  - 文件的权限（参见第6章）
  - 文件的硬链接总数
  - 文件属主的用户名
  - 文件属组的组名
  - 文件的大小（以字节为单位）
  - 文件的上次修改时间
  -  文件名或目录名。

#### 过滤输出列表

- 当用户指定特定文件的名称作为过滤器时，ls命令只会显示该文件的信息
- ls命令能够识别标准通配符，并在过滤器中用它们进行模式匹配：
  - `问号（?）`代表一个字符；
  - `星号（*）`代表零个或多个字符。
  - `中括号（[]）`表示一个字符位置并给出多个可能的选择。

在过滤器中使用星号和问号被称为`文件扩展匹配`（file globbing），指的是使用通配符进行模式匹配的过程。通配符正式的名称叫作`元字符通配符`（metacharacter wildcards）

## 处理文件

### 常用命令

- `touch`命令 (`touch filename`)

  - 对于不存在的文件**创建空文件**。

  - 对于已经存在的文件该命令**改变文件的修改时间**，这个操作并不改变文件的内容。

  - 如果只想改变访问时间，可用`-a参数`。

- `cp命令`复制文件：`cp source destination`

  - <u>如果目标文件已经存在，cp命令可能并不会提醒这一点。最好是加上`-i`选项，强制shell询问是否需要覆盖已有文件</u>。

  - <u>**在目标目录名尾部加上了一个正斜线（/）表示复制文件到该目录下**</u>。如果没有使用正斜线，目标子目录又不存在，就会有麻烦。在这种情况下，试图将一个文件复制到目标子目录反而会创建一个同名的文件，文件内容和赋值的文件内容相同，但是不会有错误消息。

  - `R参数`可以在一条命令中递归地复制整个目录的内容。`cp -R Scripts/ Mod_Scripts`

    > 在执行cp –R命令之前，目录Mod_Scripts并不存在。它是随着cp –R命令被创建的，整个Scripts
    > 目录中的内容都被复制到其中。注意，在新的Mod_Scripts目录中，所有的文件都有对应的新日期。
    > Mod_Scripts目录现在已经成为了Scripts目录的完整副本。

  - cp命令中使用通配符。

### 制表键自动补全

### 链接文件

链接文件是Linux文件系统的一个优势。如需要在系统上维护同一文件的两份或多份副本，除了保存多份单独的物理文件副本之外，还可以采用保存一份物理文件副本和多个虚拟副本的方法。这种虚拟的副本就称为`链接`。<u>**链接是目录中指向文件真实位置的占位符**</u>。

在Linux中有两种不同类型的文件链接：

- 符号链接

  - **<u>符号链接就是一个实实在在的文件，它指向存放在虚拟目录结构中某个地方的另一个文件。这两个通过符号链接在一起的文件，彼此的内容并不相同。</u>**

  - 要为一个文件创建符号链接，原始文件必须事先存在。然后可以使用`ln命令`以及`-s选项`来创建符号链接。

    ```shell
    ln -s data_file sl_data_file
    ```

    > 注意
    >
    > - 符号链接的名字sl_data_file位于ln命令中的第二个参数位置上。显示在长列表中符号文件名后的->符号表明该文件是链接到文件data_file上的一个符号链接。
    > - 另外符号链接的文件sl_data_file仅仅只是指向data_file而已。它们的内容并不相同，是两个完全不同的文件，因此对于刚刚创建的符号链接文件，大小与数据文件的文件大小并不相同。
    >
    > - 文件或目录的`inode编号`是一个用于标识的唯一数字，这个数字由内核分配给文件系统中的每一个对象。要查看文件或目录的inode编号，可以给ls命令加入-i参数。对于上面的结果，可以发现符号链接文件和原始文件的iNode编号并不相同，因此他们是两个文件。

- 硬链接

  - 硬链接会创建独立的虚拟文件，其中包含了原始文件的信息及位置。但是它们从根本上而言<u>**是同一个文件**</u>。引用硬链接文件等同于引用了源文件。要创建硬链接，原始文件也必须事先存在，只不过这次使用`ln命令`时不再需要加入额外的参数了。
  - 带有硬链接的文件共享inode编号。这是因为它们终归是同一个文件。还要注意的是，链接计数（文件权限属性后面那一个数字）显示这两个文件都有两个链接。另外，它们的文件大小也一模一样。

  - **<u>只能对处于同一存储媒体的文件创建硬链接。要想在不同存储媒体的文件之间创建链接，只能使用符号链接。</u>**

> 复制链接文件的时候一定要小心。如果使用cp命令复制一个文件，而该文件又已经被链接到了另一个源文件上，那么你得到的其实是源文件的一个副本。这很容易让人犯晕。用不着复制链接文件，可以创建原始文件的另一个链接。同一个文件拥有多个链接，这完全没有问题。但是，**<u>千万别创建软链接文件的软链接</u>**。这会形成混乱的链接链，不仅容易断裂，还会造成各种麻烦。

### 重命名文件

`mv命令`

- 可以将文件和目录移动到另一个位置
- 重新命名（将文件移动到当前同一目录下是重命名）

- 可以在mv命令中使用-i参数。这样在命令试图覆盖已有的文件时，你就会得到提示。

- 也可以使用mv命令移动文件位置并修改文件名称

- 也可以使用mv命令移动整个目录及其内容

```shell
mv Mod_Scripts Old_Scripts
```

### 删除文件

删除文件的命令是`rm`，`-i命令参数`提示你是不是要真的删除该文件。

> bash shell中没有回收站或垃圾箱，文件一旦删除，就无法再找回。因此，在使用rm命令时，要养成总是加入-i参数的好习惯。

## 处理目录

### 创建目录

- 在Linux中创建目录很简单，用`mkdir`命令即可。

- 要想同时创建多个目录和子目录，需要加入`-p参数`

### 删除目录

- **<u>默认情况下，rmdir命令只删除空目录。</u>**

- 对于存在文件的目录，得先把目录中的文件删掉，然后才能在空目录上使用rmdir命令。

- 也可以在整个非空目录上使用rm命令。使用-r选项使得命令可以向下进入目录，删除其中
  的文件，然后再删除目录本身。

> 我们使用了tree工具。它能够以一种美观的方式展示目录、子目录及其中的文件。如果需要了解目录结构，尤其是在删除目录之前，这款工具正好能派上用场。



## 查看文件内容

- `file`命令可以查看文件是什么类型的不仅能确定文件中包含的文本信息，还能确定该文本文件的字符编码

- `cat`命令

  - 显示文本文件中所有数据

  - `-n`参数会给所有的行加上行号

  - `-b`参数只给有文本的行加上行号

  - 如果不想让制表符出现，可以用`-T`参数。-T参数会用^I字符组合去替换文中的所有制表符。

- `more`命令分页显示文本文件的内容

- `less`命令实为more命令的升级版。

- `tail`命令

  - 显示文件最后几行的内容（文件的“尾部”）。默认情况下，它会显示文件的末尾10行。

  - 可以向tail命令中加入`-n`参数来修改所显示的行数

    ```shell
    tail -n 2 log_file
    ```

  - `-f`参数是tail命令的一个突出特性。**<u>它允许你在其他进程使用该文件时查看文件的内容。tail命令会保持活动状态，并不断显示添加到文件中的内容。这是实时监测系统日志的绝妙方式。</u>**

- `head`命令

  - 显示文件开头那些行的内容。默认情况下，它会显示文件前10行的文本

  - 支持-n参数，允许你在破折号后面输入想要显示的行数：

    ```shell
    head -5 log_file
    ```





